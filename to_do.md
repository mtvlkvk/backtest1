# Крипта. Описание программы 

## Требования 

1. Один и тот же алгоритм торговли для backtest и автоматической торговли. Основной алгоритм 
– авт торговля, backtest не должен ухудшать производительность
    - возможность использовать и тестировать несколько стратегий (включая машинное обучение, в 
    идеале плюс Keras)
    - реализовать получение и хранение исторических данных в идеале в базу данных SQL/MongoDB 
    - поддержка API нескольких криптобирж и Тинькофф

2. Возможность менять алгоритмы торговли (представить их в виде функций)

3. Для backtest возможность запускать программу на разных исходных параметрах (передавать в 
файле)

4. Интерфейс. Backtest. Возможность менять параметры и видеть на графиках и цифрах результаты

5. Интерфейс. Торговля. Возможность менять параметры, видеть на графиках и цифрах результаты, 
видеть текущие ордера

6. В обоих режимах расчет эффективности торговли. Возможность видеть предыдущие (месяц назад) 
эффективности 
    - Какие параметры?
    - Как их вывести графически?
    - При расчете эффективности что делать с зависшими ордерами? (что такое "зависшие ордера"? конкретно в этой
    программе "зависших" нет. Если весит ордер, то пока он не выполнится, дальше не пойдет)

7. В обоих режимах интервалы от минуты  до часа/дня 
    - Есть минутные данные для backtest? ... Насколько я понимаю, данные минимально пяти минутки. И это, понятно,
     на криптовалюте. Кроме того, исторические данные по-моему по часам с определенного времени. 

8. Проверять (но это, наверно, не первостепенно) данные backtest на однородность. Может быть выполнять 
сглаживание (экспоненциальное)?  ... Что значит "однородность"?)))

9. Учитывать различные способы расчета комиссий

10. Отслеживание ошибок и логинг на различных уровнях
    - Куда осуществлять логинг ... а в чем проблема? либо в файлик, либо в базу. все по-моему просто
    - Когда осуществлять логинг ... когда? в смысле? после каждой операции? при ошибке? вариантов не так много

## Таблицы 

- Текущие ордера – актуальные ордера на бирже (курс, дата создания, планируемая прибыль, комиссия) 
- Расчетные ордера – от их расчета прогой до создания на бирже. Содержит новые ордера Order[i]ToNew или запросы на 
удаление старых Order[i]ToDelete. В конце каждой итерации таблица очищается 
- Выполненные ордера (курс, дата создания, дата выполнения, прибыль). Подчищается после 1000 (например) значений
- Выполненные по Стопам ордера (курс, дата создания, дата выполнения, убыток)???? Подчищается после 1000 (например) 
значений

... все это и есть в программе, называется bars итд


## Процедуры  

Datahandler – название процедуры. В скобках – передаваемые параметры 

### ОБщая схема 
DataHandler -> (тек курс, выполненные ордера, выполненные ордера) -> 
Strategy -> (новые ордера, запросы на удаление (стопы)) -> 
-> CheckEfficenty -> (текущая эффективность) -> запись в файл.
-> ExecutionHandler-> (установка новых ордеров) -> 
		-> (по новой) DataHandler

### DataHandler 
Вход: запуск программы (бэктестинг) или вызов из таймера (трейдинга)
Выход: Текущие курсы, события Order[i]Completed. Переход на след функцию Strategy 
Бэктестинг. 
Инициализирует счетчик 
Считывает курс  из файла (курс)
Check выполнения предыдущих ордеров (сравнение с курсом). Генерирует события Order[i]Completed
Трейдинг
Запускается по таймеру 
Считывает курс из биржы 
Check выполнения предыдущих ордеров (запрос на биржу и сравнение с курсом). Генерирует события Order[i]Completed

### Strategy
Вход: с предыдущей функции
Выход: ордера  Order[i]New
Бэктестинг и трейдинг . 
Анализирует курс и (возможно) создает новые ордера  (событие) Order[i]ToNew или удаляет старые  Order[i]ToDelete
	Анализирует исполненные ордера из предыдущего пункта Order[i]Completed и (возможно) 
	создает новые ордера   Order[i]New

### CheckEfficenty 
Вход: курс, выполненные ордера, стопы 
Выход: текущие параметры эффективности торговли 
Бэктестинг и трейдинг . 
	Выполняются одинаково

	
### ExecutionHandler 
Вход: Выполняется после предыдущей функции. 
Выход: Цикл окончен 
Бэктестинг. 
Анализируется таблица “Расчетные ордера” 
На их основании создаются/удаляются ордера из таблицы “Актуальные ордера”. 
Таблица с Расчетными ордерами очищается 
Трейдинг
Анализируется таблица “Расчетные ордера” 
На их основании создаются/удаляются ордера на бирже 
При успешном создании переносятся в таблицу “Актуальные ордера”  
При успешном создании таблица (строки) с Расчетными ордерами очищается 
